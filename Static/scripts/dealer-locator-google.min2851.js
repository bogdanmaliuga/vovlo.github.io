!function(){"use strict";vc.DealerLocator={}}(),function(){"use strict";vc.DealerLocator.GoogleMap={_map:null,Map:function(e,t){var o={scrollwheel:!1,zoom:parseInt(e.data("zoom"),10),center:t,panControl:!1,zoomControl:!0,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,overviewMapControl:!1};return this._map=new google.maps.Map(e[0],o),this},fitBounds:function(e){this._map.fitBounds(e)},getBounds:function(){return this._map.getBounds()},getCenter:function(){return this._map.getCenter()},getZoom:function(){return this._map.getZoom()},panBy:function(e,t){this._map.panBy(e,t)},panTo:function(e){this._map.panTo(e)},setMapTypeId:function(e){this._map.setMapTypeId(e)},setMapTypes:function(e,t){this._map.mapTypes.set(e,t)},setCenter:function(e){this._map.setCenter(e)},setZoom:function(e){this._map.setZoom(e)},marker:function(e){var t=[50,154,240];return new google.maps.Marker({position:e,map:this._map,zIndex:0,icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:"rgb("+t.join(",")+")",fillOpacity:1,scale:6,strokeWeight:0,strokeColor:"rgb("+t.join(",")+")"}})},addListener:function(e,t){google.maps.event.addListener(this._map,e,t)},addListenerOnce:function(e,t){google.maps.event.addListenerOnce(this._map,e,t)},computeDistanceBetween:function(e,t,o){return google.maps.geometry.spherical.computeDistanceBetween(e,t,o)},latLng:function(e){return new google.maps.LatLng(e.lat,e.lng)},toNativeLatLng:function(e){return e},toGoogleLatLng:function(e){return e},styledMapType:function(e,t){return new google.maps.StyledMapType(e,t)},latLngBounds:function(e,t){return new google.maps.LatLngBounds(e,t)},cluster:function(e,t){return this.markerClusterer(this._map,e,t)},markerClusterer:function(e,t,o){return new vc.DealerLocator.MarkerClusterer(e,t,o)},getGeocoder:function(){return new google.maps.Geocoder},getGeocoderStatus:function(e){return google.maps.GeocoderStatus[e]},androidMapFix:function(e){var t=this.latLng({lat:e.coords.latitude-5,lng:e.coords.longitude-5});return new google.maps.Marker({position:t,map:this._map,icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:1,scale:.01,strokeWeight:0}})},getUrl:function(){return"http://maps.google.com/?q="},getMapStyles:function(){return vc.DealerLocator.googleMapStyles},getMap:function(){return this._map}}}(),function(){"use strict";vc.DealerLocator.GoogleEvents={initialize:function(){this.googleListeners=[]},listenToGoogleEvent:function(e,t,o){this.googleListeners.push(google.maps.event.addListener(e,t,o))},stopListeningGoogleEvent:function(){for(var e=0;e<this.googleListeners.length;e++){var t=this.googleListeners[e];google.maps.event.removeListener(t)}}}}(),function(){"use strict";var e=parseInt($(".dealer-locator-map").attr("data-zoom"),10);vc.DealerLocator.GoogleSearcher={fixedZoomLevel:10,dealerDataPreloaded:parseInt($(".dealer-locator-map").attr("data-preload"),10),defaultZoomLevel:e,zoomLevels:{country:e,administrative_area_level_1:e+2,administrative_area_level_2:e+3,administrative_area_level_3:e+4,administrative_area_level_4:e+5,administrative_area_level_5:e+6,locality:11,sublocality:12,sublocality_level_1:13,sublocality_level_2:14,sublocality_level_3:15,sublocality_level_4:16,sublocality_level_5:17,point_of_interest:18,street_address:18,neighborhood:14,route:14,intersection:17,ward:16,premise:17,subpremise:18,postal_code:6,postal_code_prefix:12,airport:15,park:16,natural_feature:14,establishment:17},search:function(e,t){var o,i=new google.maps.Geocoder,a=this;i.geocode({address:e,region:vc.settings.marketId},function(e,i){if(i===google.maps.GeocoderStatus.OK){var s=a.getClosestLocation(e);s?(o=a.zoomLevels[s.types[0]]?a.zoomLevels[s.types[0]]:a.defaultZoomLevel,"us"===vc.settings.marketId&&o>a.fixedZoomLevel&&(o=a.fixedZoomLevel),a.dealerDataPreloaded?vc.dealerData.getMinBounds(s.geometry).done(function(e){a.model.set({lat:s.geometry.location.lat(),lng:s.geometry.location.lng()}),vc.DealerLocator.router.navigateToBounds("map",e,a.model.get("lat"),a.model.get("lng")),t&&t(!0)}):(vc.DealerLocator.router.navigateToLatLng("map",s.geometry.location.lat(),s.geometry.location.lng(),o),t&&t(!0))):t&&t(!1)}else t(!1)})},getClosestLocation:function(e){if(1===e.length)return e[0];for(var t=new google.maps.LatLng(this.model.attributes.lat,this.model.attributes.lng),o=0,i={item:null,distance:-1},a=0,s=e.length;s>a;a++)o=google.maps.geometry.spherical.computeDistanceBetween(t,e[a].geometry.location),(i.distance>o||-1===i.distance)&&(i={item:e[a],distance:o});return i.item}}}(),function(){"use strict";vc.DealerLocator.GoogleMarkerLabel=function(e,t){_.bindAll(this,"onAdd","draw"),this.marker=e,this.el=document.createElement("div"),this.$el=$(this.el).attr("class","dealer-marker-label").text(t.get("number")),this.listenTo(t,"change",this.dealerChanged)},vc.inherits(vc.DealerLocator.GoogleMarkerLabel,google.maps.OverlayView),vc.mixin(vc.DealerLocator.GoogleMarkerLabel.prototype,vc.DealerLocator.GoogleEvents,Backbone.Events),_.extend(vc.DealerLocator.GoogleMarkerLabel.prototype,{onAdd:function(){this.getPanes().markerLayer.appendChild(this.el)},draw:function(){var e,t,o,i=this.getProjection().fromLatLngToDivPixel(this.marker.getPosition());e=i.x-.5,t=i.y,o=Math.ceil(this.marker.getZIndex()||t)+10,this.$el.css({zIndex:o,left:e-this.marker.anchor[0]>>0,top:t-this.marker.anchor[1]>>0})},dealerChanged:function(e){var t,o=e.changedAttributes();o&&("active"in o&&(this.$el.toggleClass("active",o.active),o.active?(t=this.$el.css("zIndex")||(this.marker.getZIndex()||this.getProjection().fromLatLngToDivPixel(this.marker.getPosition()).y)+10,this.$el.attr("old-zindex",t),this.$el.css("zIndex",google.maps.Marker.MAX_ZINDEX+2)):this.$el.css("zIndex",this.$el.attr("old-zindex"))),"number"in o&&this.$el.text(o.number))},onRemove:function(){this.el.parentNode.removeChild(this.el)}})}(),function(){"use strict";vc.DealerLocator.GoogleMarker=function(e,t){_.bindAll(this,"clicked","update"),this.dealer=e;var o,i=e.get("GeoCode");if($("html").is(".lt-ie9"))o="/static/images/marker-icon.png";else{if("True"==vc.settings.enableservicetypetab){var a=[0,48,87],s=[255,203,0],r=[232,119,34];"Sales"==e.get("ServiceType")&&(this.inactiveColor=a,this.activeColor=a),"Service"==e.get("ServiceType")&&(this.inactiveColor=s,this.activeColor=s),"SalesAndService"==e.get("ServiceType")&&(this.inactiveColor=r,this.activeColor=r)}o={path:"M16.565,40.029l11.748-11.748c6.487-6.487,6.523-16.954,0.036-23.442C21.861-1.648,11.377-1.596,4.888,4.892 c-6.487,6.488-6.534,16.995-0.045,23.482L16.565,40.029",fillColor:"rgb("+this.inactiveColor.join(",")+")",fillOpacity:1,scale:1,strokeWeight:0,strokeColor:"rgb("+this.inactiveStrokeColor.join(",")+")",anchor:new google.maps.Point(this.anchor[0],this.anchor[1])}}google.maps.Marker.call(this,{position:new google.maps.LatLng(i.Latitude,i.Longitude),optimized:!1,zIndex:50*t+100,icon:o}),google.maps.event.addListener(this,"click",this.clicked),this.listenTo(this.dealer,"change:active",this.dealerActiveChanged),this.label=new vc.DealerLocator.GoogleMarkerLabel(this,e)},vc.inherits(vc.DealerLocator.GoogleMarker,google.maps.Marker),_.extend(vc.DealerLocator.GoogleMarker.prototype,Backbone.Events,{anchor:[16,40],animationDuration:150,animationInterval:1e3/60,activeScale:1.8,inactiveScale:1,activeColor:[50,154,240],inactiveColor:[0,48,87],activeStrokeColor:[47,138,213],inactiveStrokeColor:[0,35,36],clicked:function(){var e=this;setTimeout(function(){e.dealer.activate()},500)},dealerActiveChanged:function(e,t){var o=this.getIcon();t?(this.oldIndex=this.zIndex,this.setZIndex(google.maps.Marker.MAX_ZINDEX+1)):this.setZIndex(this.oldIndex),this.targetColor=t?this.activeColor:this.inactiveColor,this.targetScale=t?this.activeScale:this.inactiveScale,this.startColor=t?this.inactiveColor:this.activeColor,this.startTime=Date.now(),this.startScale=o.scale,this.lastUpdate=Date.now(),$("html").is(".lt-ie9")?this.updateIE():window.requestAnimationFrame(this.update)},updateColor:function(e,t,o){for(var i=[],a=0;a<e.length;a++)i.push(e[a]+(t[a]-e[a])*o>>0);return i},update:function(){var e=this.getIcon();if(e.scale!==this.targetScale){var t=Date.now()-this.startTime,o=Math.min(1-Math.pow(1-t/this.animationDuration,3),1),i=this.updateColor(this.startColor,this.targetColor,o);e.scale=this.startScale+(this.targetScale-this.startScale)*o,e.fillColor="rgb("+i.join(",")+")",this.setIcon(e),window.requestAnimationFrame(this.update)}},updateIE:function(){var e=this.targetScale===this.activeScale?"/static/images/marker-icon-active.png":"/static/images/marker-icon.png";this.setIcon(e)},setMap:function(e){google.maps.Marker.prototype.setMap.apply(this,arguments),this.label.setMap(e)}})}(),function(){"use strict";vc.DealerLocator.googleMapStyles=[{featureType:"road",stylers:[{hue:"#00a1ff"},{saturation:-26}]},{featureType:"water",stylers:[{hue:"#0091ff"},{saturation:-48}]},{featureType:"landscape.man_made",stylers:[{saturation:-100},{lightness:44}]},{featureType:"poi.park",stylers:[{hue:"#08ff00"},{saturation:-7}]}]}(),function(){"use strict";vc.DealerLocator.MarkerClusterer=function(e,t){var o={gridSize:this.getDeviceGridSize(),maxZoom:11,averageCenter:!1,title:"Multiple Dealers. Click to zoom in",clusterClass:"dealer-marker-label",styles:this.getDeviceStyles()};MarkerClusterer.call(this,e,[],o),this.zoomIntoCluster=!0,this.listenTo(t,"change:active",this.dealerActiveChanged),this.listenTo(vc.app,"device:changed",this.deviceChanged),this.listenTo(t,"remove",this.removeOne),this.listenTo(t,"add",this.addOne),this.listenTo(t,"sync",this.synced),this.dealersToAdd=[],this.dealersToRemove=[]},vc.inherits(vc.DealerLocator.MarkerClusterer,MarkerClusterer),_.extend(vc.DealerLocator.MarkerClusterer.prototype,Backbone.Events,{synced:function(e){this.addMarkers(this.dealersToAdd),this.removeMarkers(this.dealersToRemove),this.dealersToAdd=[],this.dealersToRemove=[];var t=e.findWhere({active:!0});t&&this.dealerActiveChanged(t,!0)},dealerActiveChanged:function(e,t){var o=e.marker,i=this.findCluster(o);t&&this.zoomIntoCluster&&i?this.zoomToMarker(o,i):t&&i?(o.cluster=i,i.clusterIcon_.hide(),o.getMap()||o.setMap(this.getMap())):t&&!i?delete o.cluster:!t&&i&&(delete o.cluster,o.getMap()&&o.setMap(null),this.canShowCluster(i)&&i.clusterIcon_.show())},canShowCluster:function(e){return!(e.getSize()>=this.getMinimumClusterSize()&&_.findWhere(e.getMarkers(),{cluster:e}))},findCluster:function(e){var t,o=this.getClusters();if(e)for(var i=o.length;i--;)if(o[i].getSize()>=this.getMinimumClusterSize()){t=o[i].getMarkers();for(var a=t.length;a--;)if(t[a]===e)return o[i]}},addOne:function(e){this.dealersToAdd.push(e.marker)},removeOne:function(e){this.dealersToRemove.push(e.marker)},zoomToMarker:function(e){var t=e.dealer.get("GeoCode");this.getMap().setCenter(new google.maps.LatLng(t.Latitude,t.Longitude)),this.getMap().setZoom(this.getMaxZoom()+1)},getDeviceGridSize:function(){return"extra-large"===vc.app.currentDevice.name?100:50},getDeviceStyles:function(){var e="extra-large"===vc.app.currentDevice.name;return[{height:e?85:43,width:e?85:43,url:e?"/static/images/marker-icon-cluster.png":"/static/images/marker-icon-cluster-mobile.png",fontFamily:"Volvo Sans Medium",fontWeight:"normal",textColor:"white",textSize:e?"16":"12",anchorText:e?[17,0]:[10,0]}]},deviceChanged:function(){this.setGridSize(this.getDeviceGridSize()),this.setStyles(this.getDeviceStyles())}})}(),function(){"use strict";vc.DealerLocator.map={_source:"GoogleMap",_searcher:"GoogleSearcher",_marker:"GoogleMarker",init:function(){var e=$(".dealer-locator-map").data("source");e&&vc.DealerLocator[e+"Map"]&&(this._source=e+"Map",this._searcher=e+"Searcher",this._marker=e+"Marker"),vc.mixin(this,vc.DealerLocator[this._source])},getSearcher:function(){return vc.DealerLocator[this._searcher]||{}},getMarker:function(e,t){return new vc.DealerLocator[this._marker](e,t)}}}(),function(){"use strict";var e=!!vc.settings.dc;vc.DealerLocator.Locator=Backbone.Model.extend({defaults:{listMode:e,zoom:5,displayLocation:!1,useBounds:!1}})}(),function(){"use strict";vc.DealerLocator.Dealer=vc.Dealer.extend({})}(),function(){"use strict";vc.DealerLocator.DealerCollection=vc.DealerCollection.extend({model:vc.DealerLocator.Dealer,url:"https://vdf.volvocars.com/OData/VDF.svc/FindDealersInBox",fetch:function(e){if(parseInt($(".dealer-locator-map").attr("data-preload"),10)){var t=this;vc.dealerData.findDealersInBox(e).done(function(o){t.set(o,e),t.trigger("sync",t)})}else if("True"==vc.settings.enableservicetypetab){var t=this;vc.dealerData.findDealersInBox(e).done(function(o){t.set(o,e),t.trigger("sync",t)})}else Backbone.Collection.prototype.fetch.call(this,e)},getDealerId:function(){},comparator:function(e){return e.marker&&this.visitorPosition?(e.set("distance",vc.DealerLocator.map.computeDistanceBetween(this.visitorPosition,e.marker.getPosition())),e.get("distance")):null},getCurrentDealerNames:function(){for(var e=[],t=0;t<this.models.length;t++)e.push(this.models[t].attributes.Name);return e}})}(),function(){"use strict";var e={baseConstants:{costAvailableClass:"cost-available",costNotAvailableClass:"cost-not-available",moneyAmountClass:".money-amount",priceInfoBlockSelector:".vcic.price-information-block-wp",costAvailabilityClassSelectors:[".cost-field",".cost-unavailable-text"],currencyStringSeparator:" "}};$.extend(e,{derivedConstants:{shippingPriceWrapperSelectors:[e.baseConstants.priceInfoBlockSelector+" .shipping-cost-wp"],totalPriceWrapperSelectors:[e.baseConstants.priceInfoBlockSelector+" .total-price-wp"],finalPaymentWrapperSelectors:[e.baseConstants.priceInfoBlockSelector+" .final-payment-wp"]}}),$.extend(e,{constants:$.extend(e.baseConstants,e.derivedConstants)}),e.unsetShippingDependentPricesWrapperSelectors=[],e.unsetShippingDependentPricesWrapperSelectors.push(e.constants.shippingPriceWrapperSelectors),e.unsetShippingDependentPricesWrapperSelectors.push(e.constants.totalPriceWrapperSelectors),e.unsetShippingDependentPricesWrapperSelectors.push(e.constants.finalPaymentWrapperSelectors),vc.DealerCollection.prototype.setMoneyAmountsWhichDependOnShippingPrice=function(t){var o=t.Price.Amount,i=t.Price.CurrencyCode,a=e.constants,s=function(e,t){if(null!=t&&t.length){var o=e+a.currencyStringSeparator+i;t.empty().append(o),$(t).formatCurrency({region:$("html").attr("lang")})}},r=function(e){if(null!=e&&e.length){var t=a.costAvailabilityClassSelectors;t.forEach(function(t){var o=e.find(t);null!=o&&o.length&&o.removeClass(a.costNotAvailableClass).addClass(a.costAvailableClass)})}},n=function(e,t){$.each(t,function(t,o){var i=$(o);i.length&&(s(e,i.find(a.moneyAmountClass)),r(i))})},l=$(a.priceInfoBlockSelector).data(),c=l.carBasePrice,d=l.depositCost;n(o,a.shippingPriceWrapperSelectors),n(+c+ +o,a.totalPriceWrapperSelectors),n(+c+o-+d,a.finalPaymentWrapperSelectors)},vc.AccordionItem.prototype.unsetMoneyAmountsWhichDependOnInvalidShippingPrice=function(){var t=e.constants,o=function(e){var o=$(e[0]);null!=o&&o.length&&$.each(t.costAvailabilityClassSelectors,function(e,i){var a=o.find(i);null!=a&&a.length&&a.removeClass(t.costAvailableClass).addClass(t.costNotAvailableClass)})};$.each(e.unsetShippingDependentPricesWrapperSelectors,function(e,t){o(t)})}}(),function(){"use strict";vc.DealerLocator.App=Backbone.View.extend({useClusters:0,fetchedBounds:null,tabClick:!1,initialize:function(){_.bindAll(this,"addOne","loadDealers","setHeight","visitorPositionChanged","zoomChanged","serviceDealers","salesDealers"),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"change:active",this.activeDealerChanged),this.listenTo(this.collection,"sync",this.synced),this.listenTo(this.collection,"dealer-name-selected",this.onDealerNameSelected),this.listenTo(this.model,"change",this.locatorChanged),this.listenTo(vc.app,"resize",_.throttle(this.setHeight,100,{leading:!1})),this.markerCounter=0,this.currentZoom=null,this.setHeight()},events:{"click .locator-services":"serviceDealers","click .locator-sales":"salesDealers"},serviceDealers:function(){$(".locator-sales").removeClass("sales-enabled"),$(".locator-services").addClass("service-enabled"),$(".locator-sales").removeClass("active-locator"),$(".locator-services").addClass("active-locator"),$(".sales-content").css("display","none"),$(".services-content").css("display","block"),this.dealerDataRefresh()},salesDealers:function(){$(".locator-services").removeClass("service-enabled"),$(".locator-sales").addClass("sales-enabled"),$(".locator-services").removeClass("active-locator"),$(".locator-sales").addClass("active-locator"),$(".sales-content").css("display","block"),$(".services-content").css("display","none"),this.dealerDataRefresh()},dealerDataRefresh:function(){vc.dealerData.deferred=!1,vc.dealerData.fetched=!1,vc.dealerData.clear().set(vc.dealerData.defaults),this.tabClick=!0,this.loadDealers()},setCustomScrollHeight:function(){if($(".scroll-bar").mCustomScrollbar(),$(".mCustomScrollbar").length>0){$(".mCustomScrollbar").css("max-height","");var e=$(".mCustomScrollbar").height()-$(".tab-section-group").height();$(".mCustomScrollbar").css("max-height",e)}},setHeight:function(){if(!$("#dealer-locator-search").is(":focus")){var e=parseInt(.9*vc.app.$window.height(),10);vc.settings.dc&&(e="auto"),this.$el.css({height:e})}},locatorChanged:function(e){var t,o,i,a,s=e.changedAttributes();!s.lat&&!s.lng||e.get("useBounds")||(t=e.get("lat"),o=e.get("lng"),this.map.setCenter(this.map.latLng({lat:t,lng:o})),this.displayLocation(),s.zoom&&this.map.setZoom(s.zoom)),(s.sw||s.ne)&&e.get("useBounds")&&(i=e.get("sw"),a=e.get("ne"),this.map.fitBounds(this.map.latLngBounds(i,a)),this.map.panBy(1,1),this.displayLocation()),"listMode"in s&&(this.$scroller.toggleClass("active",s.listMode),$(".map-container").toggleClass("hidden-xs"))},displayLocation:function(){if(this.model.get("displayLocation")){var e=this.model.get("visitorPosition");e||this.model.get("lat")&&this.model.get("lng")&&(e=vc.DealerLocator.map.latLng({lat:this.model.get("lat"),lng:this.model.get("lng")})),e&&(vc.DealerLocator.VisitorMarker?vc.DealerLocator.VisitorMarker.setPosition(e):vc.DealerLocator.VisitorMarker=this.map.marker(e),this.collection.visitorPosition=e)}},addOne:function(e){this.markerCounter++;var t=vc.DealerLocator.map.getMarker(e,this.markerCounter);this.useClusters||t.setMap(this.map.getMap()),e.marker=t},removeOne:function(e){this.useClusters||e.marker.setMap(null)},addAll:function(e){e.each(this.addOne)},synced:function(){var e,t;this.collection.sort(),this.initMap&&(e=this.map.toGoogleLatLng(this.map.getCenter()),t={coords:{latitude:e.lat(),longitude:e.lng()}},this.map.androidMapFix(t)),"undefined"!=typeof dealerPicker1&&dealerPicker1&&this.collection.models.length>0&&(dealerPicker1.collection=this.collection.clone(),dealerPicker1.synced())},onDealerNameSelected:function(){var e=this,t=e.clusterer;if(!t)return void e.zoomToMarkers();var o=t.getMaxZoom(),i=t.getGridSize();t.setMaxZoom(1),t.setGridSize(1),t.repaint(),e.zoomToMarkers(function(){t.setMaxZoom(o),t.setGridSize(i),t.repaint()})},zoomToMarkers:function(e){var t,o=this.collection,i=13,a=this.map;o.each(function(e){t?t.extend(e.marker.getPosition()):t=a.latLngBounds(e.marker.getPosition(),e.marker.getPosition())}),a.fitBounds(t),e&&a.addListenerOnce("idle",function(){e()}),a.getZoom()>i&&a.setZoom(i),this.zoomed=!0,vc.DealerLocator.router.navigateToLatLng("map",a.getCenter().lat(),a.getCenter().lng(),a.getZoom())},activeDealerChanged:function(e,t){if(t)if("extra-large"===vc.app.currentDevice.name||"undefined"!=typeof dealerPicker1&&dealerPicker1){var o=e.marker.getPosition();this.map.getBounds().contains(o)||this.map.panTo(o)}else if("extra-large"!==vc.app.currentDevice.name&&!this.model.get("listMode")){var i=new vc.DealerLocator.Overlay({model:e});vc.app.$mask.append(i.render().el)}},visitorPositionChanged:function(e){var t,o=this.model.get("visitorPosition"),i=0,a=this.isSearchRoute();!this.initMap||this.isSearchRoute&&o||(t={displayLocation:!0,visitorPosition:this.map.latLng({lat:e.coords.latitude,lng:e.coords.longitude})},o||a?o&&(i=this.map.computeDistanceBetween(o,t.visitorPosition)):(t.lat=e.coords.latitude,t.lng=e.coords.longitude),this.model.set(t),this.displayLocation(),this.map.androidMapFix(e),(!o||i>1e3)&&this.collection.sort())},isSearchRoute:function(){var e=window.location.href.split("#");if(e.length>1){var t=e[1];if(0===t.indexOf("map"))return!0}return!1},zoomChanged:function(){this.currentZoom>this.map.getZoom()&&this.loadDealers(),this.currentZoom=this.map.getZoom()},loadDealers:_.debounce(function(){var e=this.map.getBounds(),t=this.fetchedBounds;if(t&&t.equals(e)){if(!this.tabClick)return;this.tabClick=!1}t&&t.contains(e.getNorthEast())&&t.contains(e.getSouthWest()),this.fetchedBounds=e;var o=this.map.toGoogleLatLng(e.getNorthEast()),i=this.map.toGoogleLatLng(e.getSouthWest()),a=this.map.toGoogleLatLng(this.map.latLng({lat:o.lat(),lng:i.lng()})),s=this.map.toGoogleLatLng(this.map.latLng({lat:i.lat(),lng:o.lng()}));this.collection.fetch({sort:!1,add:!0,remove:!0,merge:!1,cache:!0,dataType:"jsonp",jsonp:"$callback",data:{$expand:"Services",$format:"json",topLeftlatitude:a.lat(),topLeftlongitude:a.lng(),bottomRightlatitude:s.lat(),bottomRightlongitude:s.lng(),languageId:"'"+(vc.settings.languageId||"sv")+"'",marketId:"'"+(vc.settings.marketId||"se")+"'"}}),"True"==vc.settings.enableservicetypetab&&this.setCustomScrollHeight()},400),createMap:function(e){var t=this;this.initMap=!0,this.map=vc.DealerLocator.map;var o=this.map.styledMapType(this.map.getMapStyles(),{name:"Volvo"});this.map.Map(this.$mapContainer,e),this.map.setMapTypes("volvo",o),this.map.setMapTypeId("volvo"),this.currentZoom=this.map.getZoom(),this.useClusters&&(this.clusterer=this.map.cluster(this.collection)),this.map.addListener("bounds_changed",this.loadDealers),this.map.addListener("center_changed",this.loadDealers),this.map.addListener("zoom_changed",this.zoomChanged),this.map.addListenerOnce("idle",function(){Modernizr.geolocation&&setTimeout(function(){window.navigator.geolocation.watchPosition(t.visitorPositionChanged,function(){},{enableHighAccuracy:!0})},3e3)})},render:function(){var e,t;return this.$scroller=$(".dealer-locator-list-scroller"),this.$mapContainer=$(".dealer-locator-map"),e=this.$mapContainer.data("center").split(","),t=vc.DealerLocator.map.latLng({lat:parseFloat(e[0]),lng:parseFloat(e[1])}),this.useClusters=parseInt(this.$mapContainer.data("cluster"),10),this.form=new vc.DealerLocator.Form({el:this.$(".dealer-locator-form"),model:this.model,collection:this.collection}).render(),this.list=new vc.DealerLocator.Accordion({el:this.$(".dealer-accordion"),collection:this.collection}).render(),this.createMap(t),this}})}(),function(){"use strict";vc.DealerLocator.Form=Backbone.View.extend({initialize:function(){if(_.bindAll(this,"geocodeResultRecieved"),vc.mixin(this,vc.DealerLocator.map.getSearcher()),this.geocoder=vc.DealerLocator.map.getGeocoder(),this.listenTo(this.collection,"sync",this.updateCount),this.listenTo(this.model,"change:listMode",this.listModeChanged),this.listenTo(vc.app,"resize",this.updateHeight),vc.settings.dc&&!vc.settings.isDiplomat){var e=$("input[name='Order.ZipCode']");this.searchByZip(e)}},events:{submit:"submitSearch","click .toggle-list":"toggleList","click #search-btn":"submitSearch"},updateCount:function(){this.collection.length>0?(this.hasResults(),this.$count.text(this.collection.length)):this.noResults(),this.updateHeight()},submitSearch:function(e){e.preventDefault();var t=this.$search.val(),o=this;this.$noResults.hide(),this.search(t,function(e){e===!0?(o.model.set("displayLocation",!0),$("#dealer-locator-search").blur(),o.hasResults()):o.noResults(),o.updateHeight()})},searchByZip:function(e){var t=this;e.focusout(t,function(o){o.preventDefault();var i=e.val(),a=vc.DealerLocator,s=t,r=$(".no-results");r.hide(),s.search(i,function(e){e?(a.app.model.set("displayLocation",!0),$("#dealer-locator-search").blur(),r.hide()):r.show()})})},noResults:function(){this.$count.parent().hide(),this.$noResults.show()},hasResults:function(){this.$noResults.hide(),this.$count.parent().show()},updateHeight:function(){var e=parseInt(this.$el.css("height"),10),t=parseInt(this.$scroller.css("paddingTop"),10);$("html").is(".lt-ie9.no-csstransforms")&&(e+=2*parseInt(this.$el.css("paddingTop"),10)),e!==t&&this.$scroller.css("paddingTop",e+"px")},listModeChanged:function(e,t){this.$icon.toggleClass("icon-list",!t).toggleClass("icon-map-alt",t)},toggleList:function(e){e.preventDefault();var t=this.model.get("listMode")?"map":"list",o=this.model.get("lat"),i=this.model.get("lng"),a=this.model.get("zoom");vc.DealerLocator.router.navigateToLatLng(t,o,i,a)},geocodeResultRecieved:function(e,t){if(e&&t===vc.DealerLocator.map.getGeocoderStatus("OK")){var o=_(e).first();if(o){var i=this.model.get("listMode")?"list":"map";return i+="/at/"+o.geometry.location.lat()+","+o.geometry.location.lng(),vc.DealerLocator.router.navigate(i,{trigger:!0})}}},render:function(){var e=this;return this.$search=this.$("#dealer-locator-search"),this.$count=this.$(".count"),this.$icon=this.$(".icon"),this.$noResults=this.$(".no-results"),this.$scroller=$(".dealer-locator-list-scroller:first"),"extra-large"===vc.app.currentDevice.name&&this.enableAutocomplete(this.$search,function(){return e.collection}),this.updateHeight(),this}}),vc.mixin(vc.DealerLocator.Form.prototype,vc.DealerAutocomplete)}(),function(){"use strict";vc.DealerLocator.Accordion=vc.Accordion.extend({tagName:"ul",className:"dealer-accordion",itemView:vc.DealerLocator.AccordionItem,initialize:function(){_.bindAll(this,"addOne"),vc.Accordion.prototype.initialize.apply(this,arguments),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"numbered",this.numbered),this.listenTo(this.collection,"change:active",this.activeDealerChanged),this.listenTo(this.collection,"sync",this.synced),this.serviceValues=vc.dictionary.DealerLocator},activeDealerChanged:function(e,t){if(t){var o=this,i="",a="",s="";setTimeout(function(){$("ul.dealer-accordion")&&$("ul.dealer-accordion").children("li").length>0?(i=$("ul.dealer-accordion").children("li").eq(o.collection.indexOf(e)),a=$("ul.dealer-accordion").children("li").eq(0).position().top,s=i.position().top-a,"True"==vc.settings.enableservicetypetab?$(".scroll-bar").mCustomScrollbar("scrollTo",i):o.$el.animate({scrollTop:s})):$("div.dealer-picker-results")&&$("div.dealer-picker-results").children("div").length>0&&(i=$("div.dealer-picker-results").children("div").eq(o.collection.indexOf(e)),a=$("div.dealer-picker-results").children("div").eq(0).position().top,s=i.position().top-a,$("div.dealer-picker-results").animate({scrollTop:s}))},300)}},synced:function(){$("ul.dealer-accordion").addClass("loaded")},numbered:function(){var e=this.collection.map(function(e){return e.view.el});this.$el.append(e)},addOne:function(e){e.view="undefined"!=typeof dealerPicker1&&null!==dealerPicker1&&"undefined"!==dealerPicker1?new vc.DealerPickerItem({model:e,className:"dealer-picker-item"}):new vc.DealerLocator.AccordionItem({model:e,animate:!!this.animate});for(var t in e.attributes.Services)e.attributes.Services[t].ServiceName=this.serviceValues[e.attributes.Services[t].ServiceType]?this.serviceValues[e.attributes.Services[t].ServiceType]:null;this.$el.append(e.view.render().el)},addAll:function(e){this.$el.empty(),e.each(this.addOne)}})}(),function(){"use strict";vc.DealerLocator.AccordionItem=vc.AccordionItem.extend({tmpl:templates["dealer-accordion-item"],initialize:function(){vc.AccordionItem.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"remove",this.remove),this.listenTo(this.model,"change",this.dealerChanged)},dealerChanged:function(e){var t=e.changedAttributes();"active"in t&&this.setExpanded(t.active),"number"in t&&(this.$el.data("number",t.number),this.$number.text(t.number)),"distance"in t&&this.$distance.text(e.getFormattedDistance())},togglerClicked:function(e){return e.preventDefault(),this.model.get("active")?this.model.set("active",!1):void this.model.activate()},orderUrls:function(){var e=["schedule_service","new_car_inventory","df","local_offers"],t=function(e){if(!e.Name)switch(e.UrlType){case"schedule_service":e.Name="Service Appointment";break;case"new_car_inventory":e.Name="New Inventory";break;case"df":e.Name="Used Inventory";break;case"local_offers":e.Name="Dealer Offers"}};this.model.attributes.Urls.sort(function(o,i){return t(o),t(i),$.inArray(o.UrlType,e)-$.inArray(i.UrlType,e)})},setRequestQuoteUrl:function(){var e=vc.settings.requestQuoteURL||"/us/tools/design-and-buy/request-a-quote",t=this.model.get("QuoteUrl");if(t){var o=t.substring(t.substring(0,t.indexOf("?")).lastIndexOf("/")+1,t.indexOf("?"));this.model.set("QuoteUrl",e+encodeURI(t.substring(t.indexOf("?")))+"&formid="+o)}},render:function(){return this.model.attributes.isUS="us"===vc.settings.marketId,this.model.attributes.nonUS=!this.model.attributes.isUS,this.model.attributes.isDiplomat=vc.settings.isDiplomat,vc.settings.dc&&(this.tmpl=templates["dc-dealer-accordion-item"]),"1"!=vc.settings.enableViewInventoryCTA?jQuery(".view-inventory").remove():"1"==vc.settings.enableViewInventoryCTA&&""==$.trim(this.model.attributes.ViewInventoryURL.length)&&jQuery(".view-inventory").remove(),"True"==vc.settings.enableservicetypetab&&(this.tmpl=templates["dealer-accordion-servicetype"]),this.model.attributes.mapURL=vc.DealerLocator.map.getUrl(),this.model.attributes.isUS&&(this.orderUrls(),this.setRequestQuoteUrl()),this.$el.html(this.tmpl.render(this.model.toJSON())),this.$number=this.$(".dealer-marker span"),this.$distance=this.$(".dealer-distance"),vc.AccordionItem.prototype.render.call(this)}})}(),function(){"use strict";vc.DealerLocator.Overlay=vc.Overlay.extend({className:vc.Overlay.prototype.className+" dealer-overlay",tmpl:templates["dealer-overlay"],initialize:function(){vc.Overlay.prototype.initialize.apply(this,arguments),_.bindAll(this,"getDirectionsClicked"),"True"==vc.settings.enableservicetypetab&&(this.tmpl=templates["dealer-overlay-servicetype"])},events:_.extend({},vc.Overlay.prototype.events,{"click .dealer-overlay-directions":"getDirectionsClicked"}),remove:function(){return this.model.set("active",!1),vc.Overlay.prototype.remove.call(this)},getDirectionsClicked:function(e){e.preventDefault()}})}(),function(){"use strict";vc.DealerLocator.Router=Backbone.Router.extend({initialize:function(e){this.model=e.model,this.route("","defaultRoute"),vc.mixin(this,vc.DealerLocator.map.getSearcher()),this.route(/map(\/at\/([^\/]+))?(\/zoom\/([^\/]+))?(\/search\/([^\/]))?\/?/i,"mapRoute"),this.route(/list(\/at\/([^\/]+))?(\/zoom\/([^\/]+))?(\/search\/([^\/]))?\/?/i,"listRoute"),this.route(/map\/bnd\/([^\/]+)?\/([^\/]+)?\/([^\/]+)?\/([^\/]+)?\/?/i,"mapBoundsRoute"),this.route(/list\/bnd\/([^\/]+)?\/([^\/]+)?\/([^\/]+)?\/([^\/]+)?\/?/i,"listBoundsRoute"),this.checkForAndHandleQueryParameter(),Backbone.History.started&&_.defer(_.bind(Backbone.history.loadUrl,Backbone.history))},checkForAndHandleQueryParameter:function(){var e=this.getQueryStringFromKey("q"),t=this;null!==e&&(e=decodeURIComponent(e),this.search(e,function(e){e===!0?(t.model.set("displayLocation",!0),history.replaceState&&history.replaceState({},"",window.location.href.replace(window.location.search,""))):this.model.set({listMode:!1})}))},parseAttributes:function(e){if(!e)return{};var t,o,i,a={};if(t=e[1],o=e[3],i=e[5],t){var s=t.split(",");a.lat=parseFloat(s[0]),a.lng=parseFloat(s[1]),a.displayLocation=!0}return o&&(a.zoom=parseInt(o,10)),i&&(a.search=i,a.displayLocation=!0),a},parseBoundsAttributes:function(e){if(!e)return{};var t,o,i,a,s,r={};return o=e[0],t=e[1],a=e[2],s=e[3],o&&(i=o.split(","),r.sw=vc.DealerLocator.map.latLng({lat:parseFloat(i[0]),lng:parseFloat(i[1])}),r.displayLocation=!0),t&&(i=t.split(","),r.ne=vc.DealerLocator.map.latLng({lat:parseFloat(i[0]),lng:parseFloat(i[1])
}),r.displayLocation=!0),a&&s&&(r.lat=a,r.lng=s),r},getQueryStringFromKey:function(e){var t=window.location.search.substring(1),o=t.split("&"),i=null;return $(o).each(function(t,o){var a=o.split("=");a[0]===e&&(i=a[1])}),i},defaultRoute:function(){this.model.set({listMode:!1})},mapRoute:function(){var e=Array.prototype.slice.call(arguments),t=_.extend({listMode:!1,useBounds:!1},this.parseAttributes(e));this.model.unset("sw",{silent:!0}).unset("ne",{silent:!0}).set(t)},listRoute:function(){var e=Array.prototype.slice.call(arguments),t=_.extend({listMode:!0,useBounds:!1},this.parseAttributes(e));this.model.unset("sw",{silent:!0}).unset("ne",{silent:!0}).set(t)},mapBoundsRoute:function(){var e=Array.prototype.slice.call(arguments),t=_.extend({listMode:!1,useBounds:!0},this.parseBoundsAttributes(e));this.model.set(t)},listBoundsRoute:function(){var e=Array.prototype.slice.call(arguments),t=_.extend({listMode:!0,useBounds:!0},this.parseBoundsAttributes(e));this.model.set(t)},createLatLngUrl:function(e,t,o,i){var a=e+"/at/";return o&&(a+=t+","+o),i&&(a+="/zoom/"+i),a},navigateToLatLng:function(e,t,o,i){this.navigate(this.createLatLngUrl(e,t,o,i),{trigger:!0})},createBoundsUrl:function(e,t,o,i){var a=e,s=t.getSouthWest(),r=t.getNorthEast();return a+="/bnd/"+s.lat()+","+s.lng()+"/"+r.lat()+","+r.lng(),o&&i&&(a+="/"+o+"/"+i),a},navigateToBounds:function(e,t,o,i){this.navigate(this.createBoundsUrl(e,t,o,i),{trigger:!0})}})}(),function(){"use strict";if($(".dealer-locator").length>0||$(".dealer-picker").length>0){var e=new vc.DealerLocator.Locator,t=new vc.DealerLocator.DealerCollection;vc.DealerLocator.map.init(),vc.DealerLocator.router=new vc.DealerLocator.Router({model:e}),vc.DealerLocator.app=new vc.DealerLocator.App({el:$(".dealer-locator"),collection:t,model:e}).render()}}();